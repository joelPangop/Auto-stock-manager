<h2 mat-dialog-title>Nouvelle voiture</h2>

<mat-dialog-content [formGroup]="form" class="grid">
  <div class="row-inline">
    <mat-form-field appearance="outline" class="grow">
      <mat-label>Marque</mat-label>
      <mat-select formControlName="idMarque">
        <mat-option *ngFor="let m of marques" [value]="m.id">{{ m.nom }}</mat-option>
        <mat-divider></mat-divider>
        <mat-option (click)="addMarque()">➕ Ajouter une marque</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('idMarque')?.hasError('required')">Obligatoire</mat-error>
    </mat-form-field>
<!--    <button mat-icon-button type="button" (click)="addMarque()" matTooltip="Ajouter une marque">-->
<!--      <mat-icon>add</mat-icon>-->
<!--    </button>-->
  </div>

  <div class="row-inline">
    <mat-form-field appearance="outline" class="grow">
      <mat-label>Modèle</mat-label>
      <mat-select formControlName="idModele" [disabled]="!form.value.idMarque">
        <mat-option *ngFor="let mo of modeles" [value]="mo.id">{{ mo.nom }}</mat-option>
        <mat-divider></mat-divider>
        <mat-option (click)="addModele()">➕ Nouveau modèle…</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('idModele')?.hasError('required')">Obligatoire</mat-error>
    </mat-form-field>
<!--    <button mat-icon-button type="button" (click)="addModele()" [disabled]="!form.value.idMarque" matTooltip="Ajouter un modèle">-->
<!--      <mat-icon>add</mat-icon>-->
<!--    </button>-->
  </div>

  <mat-form-field appearance="outline">
    <mat-label>Année</mat-label>
    <input matInput type="number" formControlName="annee">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>VIN</mat-label>
    <input matInput formControlName="vin">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Couleur</mat-label>
    <input matInput formControlName="couleur">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Kilométrage</mat-label>
    <input matInput type="number" formControlName="kilometrage">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Prix d'achat (CAD)</mat-label>
    <input matInput type="number" formControlName="prixAchat">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Prix de vente (CAD)</mat-label>
    <input matInput type="number" formControlName="prixVente">
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Statut</mat-label>
    <mat-select formControlName="statut">
      <mat-option *ngFor="let s of statuts" [value]="s">{{ s }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Fournisseur</mat-label>
    <mat-select formControlName="idFournisseur">
      <mat-option [value]="null">— Aucun —</mat-option>
      <mat-option *ngFor="let f of fournisseurs" [value]="f.id">
        {{ f.nom }} <span *ngIf="f.type">({{ f.type }})</span>
      </mat-option>
      <mat-divider></mat-divider>
      <mat-option [value]="NEW_SUPPLIER">➕ Nouveau fournisseur…</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Date d’entrée en stock</mat-label>
    <input matInput type="date" formControlName="dateEntreeStock">
  </mat-form-field>

  <mat-checkbox formControlName="creerMouvementEntree">
    Créer un mouvement d’entrée automatiquement
  </mat-checkbox>

  <mat-error *ngIf="form.errors?.api" class="api-error">
    Erreur lors de l’enregistrement.
  </mat-error>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button (click)="cancel()">Annuler</button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="loading || form.invalid">
    <mat-icon>save</mat-icon>&nbsp;Enregistrer
  </button>
</mat-dialog-actions>
