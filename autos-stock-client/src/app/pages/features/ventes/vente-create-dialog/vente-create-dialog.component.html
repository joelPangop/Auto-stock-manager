<h2 mat-dialog-title>Nouvelle vente</h2>

<mat-dialog-content [formGroup]="form" class="grid">
  <mat-form-field appearance="outline">
    <mat-label>Client</mat-label>
    <mat-select formControlName="idClient">
      <mat-option *ngFor="let c of clients" [value]="c.id">
        {{ c.nom }} <span *ngIf="c.email">({{ c.email }})</span>
      </mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('idClient')?.hasError('required')">Obligatoire</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Vendeur</mat-label>
    <mat-select formControlName="idVendeur">
      <mat-option *ngFor="let u of vendeurs" [value]="u.id">
        {{ u.nom }} — {{ u.role }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('idVendeur')?.hasError('required')">Obligatoire</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Date de vente</mat-label>
    <input matInput type="date" formControlName="dateVente">
    <mat-error *ngIf="form.get('dateVente')?.hasError('required')">Obligatoire</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Prix final (CAD)</mat-label>
    <input matInput type="number" formControlName="prixFinal">
    <mat-error *ngIf="form.get('prixFinal')?.hasError('required')">Obligatoire</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Méthode de paiement</mat-label>
    <mat-select formControlName="modePaiement">
      <mat-option *ngFor="let m of modes" [value]="m.value">{{ m.label }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Acompte (optionnel)</mat-label>
    <input matInput type="number" formControlName="acompteMontant" placeholder="ex: 1000">
  </mat-form-field>

  <mat-error *ngIf="form.errors?.api" class="api-error">
    Erreur lors de l’enregistrement. Réessaie.
  </mat-error>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button (click)="cancel()">Annuler</button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="loading || form.invalid">
    <mat-icon>save</mat-icon>&nbsp;Enregistrer
  </button>
</mat-dialog-actions>
